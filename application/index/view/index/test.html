<!DOCTYPE html>
<html>
  <head>
    <title>指纹采集</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=10"/>
    <style type="text/css">
    	body{ text-align:center}
	</style> 
	 <script type="text/javascript">
	        var doFinger = false;
	        var memberIdx = 0;
	        var fingerIdx = 1;
	        var fingerImageId = "";
	        var fingerImageStr = "data:image/jpeg;base64,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";
			//此方法保存会员信息的Json，请求URL为：/CCService/club/modify				
			function GetJsonData() {
			    var json = {
					    "cardNo": "",
					    "cardId":"C3A8F4F6695140CA82FFE4A6FF6EC9A7",
					    "startDate":"20170101",
					    "endDate":"20180320",
					    "memberName":"",
					    "idNumber":"36220319850923",
					    "phone":"20170320",
					    "photo":"18675583197",
					    "addr":"深圳市",
					    "ctrlFlag":1,
					    "members":[
					        {
					            "cardNo": "",
					            "memberName": "",
					            "memberType":"00",
					            "memberBirthday":"2017-03-01", 
					            "fingerImage1":"1", 
					            "fingerImage2":"1",
					            "isSub":0
					        }
					    ]
					};
			    return json;
			}	
			var reqJson = GetJsonData();
			//加载事件
			function LoadAttachEvent()
			{			
		    ZKFPM.attachEvent("OnAsynExecuted",AsynExecuted);
		    //alert(1);
			}
			//分离事件
			function UnloadDetachEvent()
			{			
				ZKFPM.detachEvent("OnAsynExecuted",AsynExecuted);
				ZKFPM.disConn();
			}
			//监听事件
			function AsynExecuted(szCmdName,szEventName,szResult,szValue)
			{
				console.log("AsynExecuted{szCmdName="+szCmdName+"}{szEventName="+szEventName+"}{szResult="+szResult+"}{szValue="+szValue+"}");
				if( szEventName =="InfoMation")
				{
					$("#request-process-patent").html("正在采集指纹特征点," + szValue); 
				}
				else if(szEventName =="ExecResult")
				{
					if(szResult==0){
						if(szValue != null){
						   if(fingerIdx == 1){
							reqJson.members[memberIdx].fingerImage1 = szValue;
						   }
					       reqJson.members[memberIdx].fingerImage2 = szValue;
				    	   $("#" + fingerImageId).attr('src',fingerImageStr); 
				    		$("#request-process-patent").html("采集指纹成功");
    	   	 			}  		
					}else{
						$("#request-process-patent").html("采集指纹失败,重新采集：" +　szValue);   	   
					}
					doFinger = false;
				}
		 }			
	  </script>	
  	</head>	
	<body onload="LoadAttachEvent()" onunload="UnloadDetachEvent()">
	<object classid="clsid:738FBC0C-9682-4B82-AB55-F2DA841B6A48" id="ZKFPM" height="0" width="0" ></object>	
    <div class="container">
    		<div class="row">
						会员卡号：<input type="text" id="cardNo" />
						姓名：<input type="text" id="memberName"/>
			</div>
			<div class="row">
						<img id="leftFingerImage" src="data:image/jpeg;base64," alt="" width="150" height="150" />
						<button id="leftFinger">采集左手指纹</button>
			</div>
			<div class="row">
						<img id="rightFingerImage" src="data:image/jpeg;base64," alt="" width="150" height="150" />	
		 				<button id="rightFinger">采集右手指纹</button>
			</div>
			<div class="row">
		 				<button id="btnSend">保存会员</button>
			</div>
			<div class="row">
				 <div id="request-process-patent"></div>
			</div>
    </div>

<input id="btnPrint" type="button" value="打印" onclick="javascript:window.print();" /> 

<input id="btnPrint" type="button" value="打印预览" onclick="preview(1)" /> 
<style type="text/css" media=print> 
.noprint{display : none } 
</style> 


<p class="noprint">不需要打印的地方</p> 



<p>XXXXX</p> 
<!--startprint1-->要打印的内容<!--endprint1--> 

    <!-- JavaScript 放置在文档最后面可以使页面加载速度更快 -->
    <!-- 可选: 包含 jQuery 库 -->
    <script src="__STATIC__/js/jquery-1.12.4.min.js"></script>
    <script src="__STATIC__/js/jquery-ui.min.js"></script>
    
    <script type="text/javascript">
function preview(oper)
{ 
if (oper < 10)
{ 
bdhtml=window.document.body.innerHTML;//获取当前页的html代码 
sprnstr="<!--startprint"+oper+"-->";//设置打印开始区域 
eprnstr="<!--endprint"+oper+"-->";//设置打印结束区域 
prnhtml=bdhtml.substring(bdhtml.indexOf(sprnstr)+18); //从开始代码向后取html 

prnhtml=prnhtml.substring(0,prnhtml.indexOf(eprnstr));//从结束代码向前取html 
window.document.body.innerHTML=prnhtml; 
window.print(); 
window.document.body.innerHTML=bdhtml; 
} else { 
window.print(); 
} 
} 

		    $(document).ready(function() { 
		    	  $("#request-process-patent").html("正在连接并打开指纹仪设备，请稍等...");
		    	   var hr = ZKFPM.OpenDevice();
		    	   if(hr != 0 ){
		    	   	$("#request-process-patent").html("连接并打开指纹仪设备失败：" + hr);
		    	   	return;
		    	   }
		    	  $("#request-process-patent").html("打开指纹仪设备成功，可以进行指纹采集...");
		    	  jQuery.support.cors = true;
			});    	      	
    	   $("#leftFinger").click(function() {
    	   	  if(!doFinger){
	    	   	  	doFinger = true;
	    	   	  	memberIdx = 0 ;
	    	   	  	fingerIdx = 1;
	    	   	  	fingerImageId = "leftFingerImage";
	    	   	  	$("#" + fingerImageId).attr('src',"");
		    	    $("#request-process-patent").html("请放入手指采集...");
					ZKFPM.Input();				
	    	   	}else{
					alert("正在采集");  	   	
	    	   	} 	
			});
    	   $("#rightFinger").click(function() {
    	   	  if(!doFinger){
	    	   	  	doFinger = true;
	    	   	  	memberIdx = 0 ;
	    	   	  	fingerIdx = 2;
	    	   	  	fingerImageId = "rightFingerImage";
	    	   	  	$("#" + fingerImageId).attr('src',"");
		    	    $("#request-process-patent").html("请放入手指采集...");
					ZKFPM.Input();				
	    	   	}else{
					alert("正在采集");  	   	
	    	   	} 	   	
			});
         $("#btnSend").click(function() {
				    $("#request-process-patent").html("正在提交数据，请勿关闭当前窗口...");
				    reqJson.cardNo = $("#cardNo").val();
				    reqJson.memberName = $("#memberName").val();
				    reqJson.members[0].cardNo = $("#cardNo").val();
				    reqJson.members[0].memberName = $("#memberName").val();
				    console.log(JSON.stringify(reqJson));
				    $.ajax({
				        type: "POST",
				        url: "http://127.0.0.1:8080/CCService/club/modify",
				        data: { reqJson: JSON.stringify(reqJson) },
				        dataType: 'json',
				        beforeSend: function(xhr){
				        	//该值为Login服务端返回,这个DEMO为暂时写死数据库中存在的值
				        	xhr.setRequestHeader('X-Auth-Token', 'YWRtaW5fMF9FNzVENUQ4QzI5REM0NjBCODBFMkRBOTZEQUUxMjBEMA==');
				        },
				        success: function (message) {
				        	 $("#request-process-patent").html("提交数据成功:"+message.msg);
				        },
				        error: function (message) {
				        	var retMsg = message.responseJSON;
				            $("#request-process-patent").html("提交数据失败:"+retMsg.msg);
				        }
				    });
				});			
    </script>
  </body>

</html>
